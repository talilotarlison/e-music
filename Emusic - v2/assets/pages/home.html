<!DOCTYPE html>
<html xml:lang="pt-br" lang="pt-br">
<!--Header de dados da pagina OK-->

<head>
  <meta charset="UTF-8">
  <!--Manifeesto WPA-->
  <link rel="manifest" href="../../manifest.json">
  <!--Tags metadados e tags links de fontes e icones do google, tambem css local da pgaina -->
  <meta name="keywords" content="music,video login, metatag, html" />
  <meta http-equiv="content-language" content="pt-br" />
  <meta name="author" content="Talilo" />
  <meta name="description" content="Esta é a pagina da E-music">
  <meta name="robots" content="noindex" />
  <meta name="robots" content="nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width">
  <link rel="shortcut icon" href="../img/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="../css/home-style.css">
  <title>E-music</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,100,0,0" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>
<!--Corpo da principal da pagina-->

<body>
  <!--Corpo da principal da pagina-->
  <header>
    <nav class="d-flex justify-content-around d-flex align-items-center  bg-dark position-fixed" id="header">
      <div class="container">
        <a class="navbar-brand" href="#">
          <span class="material-symbols-outlined">
            music_note
          </span>
          <h1 class="logo" title="E-music">E-music</h1>
        </a>
      </div>
      <div class="btn-sair">
        <button class="sair" onclick="deslogar()"><span title="Sair" class="material-symbols-outlined">
            logout
          </span></button>
      </div>
    </nav>
    <!--Menu de acesso as musicas-->
    <div id="header_main">
      <div class="inicio">
        <a class="navbar-brand " href="#" id="btnHome">
          <span class="material-symbols-outlined">
            home
          </span>
          <h1 class="logo inicio-name">Inicio</h1>
        </a>
      </div>
      <div class="biblioteca">
        <a class="navbar-brand" href="#" id="btnBio">
          <span class="material-symbols-outlined">
            queue_music
          </span>
          <h1 class="logo biblioteca-name">Biblioteca</h1>
        </a>
      </div>
      <div class="biblioteca" id="btn_add_conteudo">
        <a class="navbar-brand" href="#">
          <span class="material-symbols-outlined">
            library_add
          </span>
          <h1 class="logo biblioteca-name">Adicionar</h1>
        </a>
      </div>
      <div class="biblioteca" id="">
        <a class="navbar-brand" href="http://www.youtube.com.br" target="_blank">
          <span class="material-symbols-outlined">
            quick_reference_all
            </span>
          <h1 class="logo biblioteca-name">Buscar</h1>
        </a>
      </div>
    </div>
  </header>
  <main class="container-fluid">
    <!-- Content here add musicas-->
    <section class="box-form" id="form-hidden">
      <form id="salva-dados">
        <div class="item1 item">
          <label for="nome">Musica:</label>
          <input type="text" id="nome" placeholder="Digite o Nome" />
        </div>
        <div class="responsivo">
          <div class="item2 item">
            <label for="link">URL:</label>
            <input type="text" id="link" placeholder="Digite a URL" />
          </div>
          <div class="item3 item">
            <label for="categoria">Genero:</label>
            <select name="plataforma" id="categoria">
              <option disabled selected value="Favoritos" selected>Escolha uma opção </option>
              <option value="Gospel">Gospel</option>
              <option value="Pop">Pop</option>
              <option value="Rock">Rock</option>
              <option value="Podcast">Podcast</option>
            </select>
          </div>
          <button type="submit" id="salvarLink"><span class="material-symbols-outlined">
              add
            </span></button>
        </div>
      </form>
    </section>
    <!-- Mascadores de muscica de forma dinamica aqui-->
    
    <!--Parte da biblioteca-->
    <section id="bilioteca-open">
         <div id="exibe-bio">

         </div>
    </section>

    <!--Parte da home do site-->
    <section id="exibe">
      <div class="erro-cadastro"></div>
      <!-- Marcadores de musica pagina com componente gerado dinamiacamente-->
      <!--<div class="favorito">
          <div class="secao-favorito">
            <input type="checkbox" id="select" name="select" value="" />
            <div class="nome-favorito">
             <button type="submit"><span class="material-symbols-outlined">
              play_arrow
              </span></button>
              <h2>Google</h2>
            </div>
          </div>
          <div class="remover">
            <div>
              <h3><span class="material-symbols-outlined">
                  bookmark
                </span>Favoritos</h3>
              <h3><span class="material-symbols-outlined">
                  captive_portal
                </span>22/08/2023</h3>
            </div>
            <button type="button" disabled><span class="material-symbols-outlined">
                delete
              </span></button>
          </div>
        </div>-->
    </section>
  </main>
      <footer class="container-fluid" style="display: none;" id="footerMusic">
        <div>
          <!-- As a heading -->
          <div class="barra_footer">
            <div class="player">
              <div class="nome-favorito">
                <button id="musicaToca" type="submit" type="button" data-bs-toggle="modal"
                  data-bs-target="#myModal"><span class="material-symbols-outlined">
                    music_note
                    </span></button>
                <div class="nomes">
                  <label for="musicaToca" id="nomeMusicBarra">Muse - The best music</label>
                  <p id="generoMusicBarra">Genero Rock</p>
                </div>
              </div>
              <!--Botao do play-->
              <div class="btn-sair">
                <button class="busca" title="Pesquisar"><span class="material-symbols-outlined">
                  favorite
                  </span></button>
                <button href="" class="sair" data-bs-toggle="modal" data-bs-target="#myModal"><span title="Expandir"
                    class="material-symbols-outlined">
                    expand_less
                  </span></button>
              </div>
            </div>
          </div>
        </div>
      </footer>

      <!-- Todos os scrips da pagina da pagina Firebase-->
      <!-- Full screen modal -->
      <div class="modal" tabindex="-1" id="myModal">
        <div class="modal-dialog">
          <div class="modal-content" id="Modal">
            <div class="modal-header" style="border: none;">
              <a class="navbar-brand" href="#">
                <span class="material-symbols-outlined">
                  music_note
                </span>
                <h1 class="logo" title="E-music">E-music</h1>
              </a>
              <button type="button" data-bs-dismiss="modal" aria-label="Close"><span class="material-symbols-outlined">
                  expand_more
                </span></button>
            </div>
            <div class="modal-body d-flex justify-content-center" id="music_yt">
              <iframe width="560" height="315" src="https://www.youtube.com/embed/2BsGn1hSe_4" title="player"
                frameborder="0" allow="autoplay; clipboard-write;">
              </iframe>
            </div>
            <div class="name-music">
              <h1 id="nomeMusicPlay">Muse - The best music</h1>
              <h2 id="generoMusicPlay"> Estilo Rock</h2>
            </div>
            <div class="botoes">
              <a href="#"><img src="../img/voltar.png" alt="Anterior" onclick="musicAleatoria()"></a>
              <a href="#"><img src="../img/play.png" alt="Player" onclick="musicAleatoria()"></a>
              <a href="#"><img src="../img/proxima.png" alt="Proxima" onclick="musicAleatoria()"></a>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary button" data-bs-dismiss="modal"><span
                  class="material-symbols-outlined">
                  settings
                </span></button>
              <button type="button" class="btn btn-secondary button" data-bs-dismiss="modal"><span class="material-symbols-outlined">
                queue_music
                </span></button>
            </div>
          </div>
        </div>
      </div>
</body>
<script src="../js/login.js"></script>
<script src="../js/favoritos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-analytics.js";
  import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAArmvLucPzXDJL2G-9CMnFK5uNXJDVkN0",
    authDomain: "bookmarks-af892.firebaseapp.com",
    projectId: "bookmarks-af892",
    storageBucket: "bookmarks-af892.appspot.com",
    messagingSenderId: "167269874777",
    appId: "1:167269874777:web:ce97025a0e3775ef264548",
    measurementId: "G-40C9NHKXDG"
  };
  async function loading() {
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    var link_musicas = document.getElementById("exibe");
    console.log(db);

    // Pegar dados Firebase e lista na tela do usuario
    var date = new Date();
    var dateAdd = date.toLocaleDateString('pt-BR');
    const valorId = Math.random().toString(16).substr(2);

    const querySnapshot = await getDocs(collection(db, "emusic"));
    querySnapshot.forEach((doc) => {
      // console.log(doc.data());
      link_musicas.innerHTML += ` <div class="favorito">
                                        <div class="secao-favorito">
                                          <input type="checkbox" id="select" name="select" value="${doc.data().id}" />
                                          <div  id="botaoLabel"  class="nome-favorito">
                                          <button type="button" id="${doc.data().link}" class="btns" botaoLabel" value="${doc.data().id}" data-bs-toggle="modal" data-bs-target="#myModal"><span class="material-symbols-outlined">
                                              music_note
                                              </span></button>
                                            <label for="${doc.data().link}">${doc.data().nome}</label>
                                          </div>
                                        </div>
                                        <div class="remover">
                                          <div>
                                            <h3><span class="material-symbols-outlined">
                                                bookmark
                                              </span>${doc.data().tipo}</h3>
                                            <h3><span class="material-symbols-outlined">
                                                captive_portal
                                              </span>${doc.data().data}</h3>
                                          </div>
                                          <button type="button" id="${doc.data().id}" disabled><span class="material-symbols-outlined">
                                              delete
                                            </span></button>
                                        </div>
                                      </div>`;
    });

    // Salvar dados Firebase
    var tipo = document.getElementById("categoria");

    const btn = document.getElementById("salvarLink");

    btn.addEventListener("click", async function (e) {
      e.preventDefault();
      const nomeLink = document.getElementById("nome");
      const urlLink = document.getElementById("link");
      const erroCadastrar = document.querySelector(".erro-cadastro");

      if (nomeLink.value != "" && urlLink.value != "") {

        // tratamento de dados das musicas do youtube pegando id do video
        var valorLink = urlLink.value;
        var myMusicLinkId = valorLink.substr(-11);

        await setDoc(doc(db, "emusic", valorId), {
          link: myMusicLinkId,
          nome: nomeLink.value,
          data: dateAdd,
          id: valorId,
          tipo: tipo.value
        });
        erroCadastrar.innerHTML = ""
        erroCadastrar.innerHTML = `<div class="alert alert-success" role="alert" style="height:35px;padding:5px !important;">
                                   Favorito adicionado com Sucesso!!
                                 </div>`;
        // alert('Adicionado com Sucesso!!')
        setTimeout(() => {
          window.location.reload(true);
        }, 1000);

      } else {
        nomeLink.style.border = " solid 1px red";
        urlLink.style.border = " solid 1px red";
        tipo.style.border = " solid 1px red";
        erroCadastrar.innerHTML = `<div class="alert alert-danger" role="alert" 
                                    style="height:35px;padding:5px !important;">
                                    Os campos estão vazio, prencha todos os campos!!
                                  </div> `;
      }

    });

    // Aplicando caixa modal quando excluir o favorito
    // O modal e ativado com atibuto na tag de botão, que so pode ser acionado quando marcador esta selecionado que ativa o botao

    // Apagando dados firebase escolhido pelo usuario
    async function itemDeleta(id) {
      await deleteDoc(doc(db, "emusic", id));
      setTimeout(() => {
        window.location.reload(true);
      }, "1000");

    }

    function excluir(id) {
      var x = document.getElementById(id)
      // Ativar botao do marcador escolhido pelo usuario
      x.disabled = false;
      x.addEventListener("click", function (e) {
        e.preventDefault();
        itemDeleta(id);
      });
    }

    // Pegar dados id do link a ser deletado 
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    var btnExcluir = document.getElementById("excluir");

    function dados() {
      for (let i = 0; i < checkboxes.length; i++) {
        checkboxes[i].addEventListener("click", function () {
          if (checkboxes[i].checked) {
            console.log(checkboxes[i].value);
            var resu = checkboxes[i].value;
            excluir(resu);
          }
        });
      }
    }


    // jogar informação da musica escolhida pelo usuario na tela do player

    // jogando na tela de biblioteca

const bioFav = document.getElementById('exibe-bio');

querySnapshot.forEach((doc) => {
bioFav.innerHTML += `<div class="caixa-box">
                          <span class="material-symbols-outlined">
                            album
                          </span>
                            <button type="button" id="${doc.data().link}" class="btns" botaoLabel" value="${doc.data().id}" data-bs-toggle="modal" data-bs-target="#myModal">${doc.data().nome}</button>
                        </div>`
})

    // pegando barra footer
    var nomeBarra = document.getElementById("nomeMusicBarra");
    var generoBarra = document.getElementById("generoMusicBarra");
    var footerAparecer = document.getElementById("footerMusic");

    //pegando player de musica
    var nomePlay = document.getElementById("nomeMusicPlay");
    var generoPlay = document.getElementById("generoMusicPlay");

    var musicaNaTela = document.getElementById("music_yt");

  // funçao pega o id e mostra o conteudo no player e na na barra futter jogando na tela
    async function info(id) {
      const docRef = doc(db, "emusic", id);
      const docSnap = await getDoc(docRef);
      console.log(docSnap.data());

      nomeBarra.innerText = docSnap.data().nome;
      generoBarra.innerText = `Genero ${docSnap.data().tipo}`;
      footerAparecer.style.display = "block";

      nomePlay.innerText = docSnap.data().nome;
      generoPlay.innerText = `Genero ${docSnap.data().tipo}`;

      musicaNaTela.innerHTML = ` <iframe 
                                  width="560" height="315" src="https://www.youtube.com/embed/${docSnap.data().link}" 
                                  title="player" frameborder="0" allow="autoplay; clipboard-write;">
                               </iframe>`;
    }
    // pegar id do botao clicado pelo usuario
    async function botao() {
      var btn = document.getElementsByClassName("btns")
      for (var i = 0; i < btn.length; i++) {
        btn[i].addEventListener('click', e => {
          var idMusic = e.target.value;
          console.log(idMusic);
          info(idMusic);
        })
      }
    }

    window.onload = botao();
    window.onload = dados();

    //ocultar  e mostrar o formulario
    const addMusic = document.getElementById('form-hidden');
    // botao adicionar para revelar formulario
    const btnAddMusic = document.getElementById('btn_add_conteudo');

    btnAddMusic.addEventListener("click", () => {

      var disp =  addMusic.style.display;

      addMusic.style.display = disp ===  "block" ? "none": "block";

      console.log("clicou");

    })

// fim da função assicrona firabase
  }
// fim da função assicrona


    var link_musicas = document.getElementById("exibe");
    // troca de telas entre home e biblioteca de forma dinamica

    const bioFav = document.getElementById('bilioteca-open');
    
    const btnOpen = document.getElementById('btnBio');

     btnOpen.addEventListener("click", bibliotecaOpen);


    function bibliotecaOpen(){
      bioFav.style.display = "none";
      on();
      console.log("tes");
    }
   
 // troca de telas entre home e biblioteca de forma dinamica 
  const btnHome = document.getElementById('btnHome');
  btnHome.addEventListener("click", bibliotecaClose);

  function bibliotecaClose(){
      bioFav.style.display = "block";
      off();
      console.log("tes")
    }


    function off(){
      link_musicas.style.display = "none"; 
    }

    function on(){
      link_musicas.style.display = "block";
    }


  window.onload = loading();
</script>

</html>